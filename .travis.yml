services: docker
env:
  global:
  - KAZOO_BRANCH=4.2

notifications:
  email:
    on_success: never
    on_failure: always
  slack:
    rooms:
    - secure: "f7S/wenBSlnhiEOUXIF2nFVYVJHcE2b2+nN1jOb1+iSG5bIfobI905zOk6/YjvG43Gk/lKCrS3T5dUInuXuG8jEM1NEG2F16Owf7SWUnrX1YOWIrLs9I5Fgd8jlURle1FL+/IKlNKSMbm2EXJ1fAnx/dbI2Pd/RaB3P2J/60Uf5+brcY5mLw9ATlAnScDwiKWMvAlhg46TezsIpvNvHaz1TrvC0Em2w1xLxeZXONvNfLT4PXAAeiyabIYN4v+b0rXEGaREEXMqUXUh0Cz3wliG5/0f3vygUfOCmsu5EupYIVwVjuigCBGOIP1rT0UTAL63DKsASkfoSZdgBcxhU0jMEnNOw+mUBmTyICfRfwDQokbi45vXtpRiAcykTx4WxY+uA+25Fu6VgiGo+BmEg29PSnvnGR5Ip/4OyynO4o/eSEm49W89AYAqUkDRdMwuL+hRObWNNfO9UgqIkrnF8R939gSSpccTXe66EB+XwcOo22EkoahvA7UTxEUqgtIfZHXQzSqtdtz/9+RNGAJdxxLvRPxQhmhnoNRt74kwrSjovqHxZvi+PVnP9oXhmuDpVKsXqJ4T6DPqJTItKe33XkxGcSkm2k8f+iOHVhPfy0e+YuHR7i38tsH3XhWG6Mk2hrM55qpSlog24BqzhthZ/RcjttcJsRbpMyNZVoOULCs7U="
    on_success: always
    on_failure: always

before_install: source scripts/ci/environment.sh
install: make build
script: make export

deploy:
  provider: releases
  api_key:
    secure: wlXhnP+l/afNdUWg++jgZWxGtNCTGG1ZebxuxpbEYnaGuW3padZSW0mu293lG5JhLqUivmAxmn6NeVuTt3noX7W8lUuBvoZpRcWrRJE/idgCgAh0EeMd2WFGvuUw6McjTIcnnOh1AqvVwC3qnp9K4jWx1m81QBdmsYQp0QO9rtW01rcXTKIikd6uMihrjI1oC+nxbp6P7l2q9urjJ/eri6IbiIgmwWV5nPZRemvDN/2TVOlXzkN7ihlxfuVVlVntlmi3LDxJJxRhoMBimn6DKtsKqsjpevtsK3cicXy1MTcapvCvxNGiCr/rAZ5k01map1GHdpj9C6RS3CJfLfU6r4H5tZKqHPjmAvRCKbhbx6Vz1kHSC5BN0Ufxjxfw0s7If1gbqmGFcFKfTVU7VodTMTU8rS/njvd55Iu8lx+jZsuus6hFqIMl8cTR6MYt+8tcIpY3D8htybXaKuipq4EYJqopVFcLS9Bco3exeoMCQ2C5uPfJI3R2dV0273gYcGdSc0QfYKcNLKRCo3NojqVzs/2rBCbkAB1hycojrsORjuUYhwhqSQhNSBYMp2dkQRKKs9rEczmFvpruEjZv3SQhH7+TlV1Sb9qh2KTMjFqTcJXWjpnQNtWaqa1QzCIoAmvnXHFqo4lThoHEHfSUmByWSn3sY6XGZsmjJ3tpS05n5O0=
  file: export/kazoo.v${KAZOO_BRANCH}.tar.gz
  skip_cleanup: true
  on:
    repo: telephoneorg/kazoo-builder
    tags: true

# after_deploy:
# - Trigger docker-kazoo build
